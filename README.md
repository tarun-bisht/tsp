# Travelling Salesman Problem using Integer Programming

This repository contains code to find solution of travelling salesman problem (TSP) using integer programming for any list of cities. TSP problem is, given a list of cities and the distances between each pair of cities, what is the shortest possible route that visits each city exactly once and returns to the origin city?

**[Results on 25 cities of Maharastra](https://tarun-bisht.github.io/tsp/data/tsp_map.html)**

## Features
- Provide method to get city details, latitude and longitude information from [openstreetmap API](https://nominatim.openstreetmap.org) using which distance between these cities is calculated using Haversine formula.
- Provide a formulation of TSP using [pyomo](http://www.pyomo.org/) that can be solved by any MILP solver supported by pyomo.

## Installation
### Install Python
There are two ways to install python in windows using [Python 3 installer](https://www.python.org/downloads/) or [Anaconda](https://docs.conda.io/projects/conda/en/latest/user-guide/install/index.html). Installing python with anaconda or [miniconda](https://docs.conda.io/en/latest/miniconda.html) is recommended. In linux Python 3 is installed by default but we can also install miniconda or conda into linux.

### Creating Virtual Environment
Create a new python virtual environment using conda or venv and activate it. If Anaconda or Miniconda is installed use `conda` else use `venv` to create virtual environments.

- Using conda
```bash
conda create --name artist
conda activate artist
conda install pip
```

- Using venv in linux
```bash
python3 -m venv path/to/create/env/artist
source path/to/create/env/artist/bin/activate
```

- Using venv in windows
```bash
python -m venv path\to\create\env\artist
path\to\create\env\artist\Scripts\activate
```

### Installing dependencies
The command below will install all the required dependencies from `requirements.txt` file.
```bash
pip install -r requirements.txt
```

## Documentation
- Input Parameters for a script can be set by using config file.
- A test config file is provided named `config.txt` it uses json formatting.

### Create Data Files
- Data file to run TSP on cities can be provided or can be created using `get_cities_data.py`.
- A `.txt` file will be needed by script that contains name of the cities. A default `cities.txt` is provided.

Create data for cities
```bash
python get_cities_data.py --names=cities.txt --save_folder=/data/
```
##### Arguments
- `--name` or `-n`: provide path to name of cities `.txt` file. (required)
- `--save_folder` or `-s` provide path to folder where data will be saved in csv. It will save two files in that folder named `cities_data.csv` or `cities_distances.csv`. (not required)

### Run TSP on cities
- TSP can be run on files that we get from `get_cities_data.py` script or data in similar format generated by this script. Test data is provided inside `\data\` folder.
- A `config` file will be needed by script that contains settings related to run script. A test config file is provided as `config.txt`

Run TSP on cities
```bash
python tsp.py --config=config.txt
```
##### Arguments
- `--config` or `-c`: provide path to config file. (required)

## TSP MILP Formulation
Let variable $x_{i,j}$ is a binary variable denoting if edge connecting $i, j$ is part of optimal solution $(1)$ or not $(0)$. Number of these variables is equal to total number of edges.

$$ 
x = 
\begin{cases}
1 &\text{if edge} (i,j) \text{is part of optimal solution} \\
0 &\text{if edge} (i,j) \text{is not part of optimal solution}
\end{cases}
$$

Another variable $u$ will track edge number, it starts from $1$ and goes till number of nodes. Number of these variables is equal to total number of nodes.

$$ 
u \in {1, 2, 3, ...., |N|}
$$

Let $d_{i,j}$ denote distance between cities $i$ and $j$

#### Model Formulation

$$min\ \sum_{i=1}^{|E|}\sum_{j=1}^{|E|} d_{i,j}x_{i,j}$$

$$st.$$

$$ \sum_{i=1}^{n}x_{i,k} = 1 \ \ \forall k\in{1, 2, 3....,|E|}, i \neq j$$

$$ \sum_{j=1}^{n}x_{k,j} = 1 \ \ \forall k\in{1, 2, 3....,|E|}, i \neq j$$           
                
$$ u_i - u_j + 1 \leq (n-1)(1-x_{i,j}) \ \ \forall i\in{1, 2, 3....,|E|}, j\in{1, 2, 3....,|E|}, i \neq j$$

$$ u_1 = 1$$

$$ u_i \ge 2 \forall i\in{2, 3....,|E|}$$

$$ u_i \le |N| \forall i\in{2, 3....,|E|}$$
